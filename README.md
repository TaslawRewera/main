# Pain Point Helper — концепт и план реализации

Этот репозиторий содержит стартовую спецификацию для веб‑сервиса, который помогает пользователю:
1. Выбрать пол и загрузить соответствующую 3D‑модель тела.
2. Указать зону боли на интерактивной анатомической модели.
3. Уточнить характер и интенсивность боли.
4. Получить вероятные причины и список подходящих специалистов.

> ⚠️ Важно: это **информационный** сервис, а не постановка диагноза. Во всех сценариях нужно показывать дисклеймер и рекомендации обратиться за очной медицинской помощью.

---

## 1) Пользовательский сценарий (MVP)

### Шаг 1. Выбор профиля
- Пол: `мужской` / `женский`.
- Дополнительно (опционально): возрастная группа, чтобы уточнять вероятности.

### Шаг 2. Интерактивная 3D‑модель
- Загружается модель тела в зависимости от пола.
- Действия пользователя:
  - вращение;
  - приближение/отдаление;
  - клик/тап по зоне боли.

### Шаг 3. Уточнение области
- После клика камера приближает выбранную область.
- Отображаются слои:
  - базовая анатомия (органы, суставы, мышцы);
  - наименование выбранной зоны.

### Шаг 4. Опрос о боли
- Характер боли: `ноющая`, `давящая`, `пульсирующая`, `жгучая`, `колющая` и т. д.
- Интенсивность боли: шкала 0–10 и/или категории `слабая`, `умеренная`, `сильная`, `острая`.
- Дополнительные триггеры (по желанию):
  - длительность;
  - когда усиливается (движение, еда, вдох, ночью);
  - сопутствующие симптомы.

### Шаг 5. Результаты
- Блок «Что это может быть» с ранжированными гипотезами.
- Блок «К какому врачу обратиться»:
  - специализация;
  - срочность обращения (`планово` / `в ближайшее время` / `срочно`).
- Блок «Красные флаги» (экстренные симптомы, при которых нужно вызвать скорую).

---

## 2) Рекомендуемая архитектура

### Frontend
- **Next.js + TypeScript** (web + дальнейшая адаптация под Telegram WebApp).
- **react-three-fiber + drei** для 3D‑сцены.
- **Zustand** или Redux Toolkit для состояния опроса.
- **i18n** (минимум RU/EN), чтобы упростить масштабирование.

### Backend
- **FastAPI** (Python) или **NestJS** (TypeScript).
- REST API для:
  - справочника зон тела;
  - опросника боли;
  - правил сопоставления «симптомы → вероятные причины → специалист»;
  - логирования сессий (обезличенно).

### Данные
- PostgreSQL:
  - `anatomy_zones`
  - `symptoms`
  - `pain_characteristics`
  - `conditions`
  - `condition_specialists`
  - `red_flags`

### 3D‑контент
- Формат: `glTF/GLB`.
- Модели: отдельные меши/карты зон, чтобы корректно определять кликнутую область.
- Оптимизация: LOD, сжатие текстур, lazy loading.

---

## 3) Пример структуры доменной модели

```text
BodyZone
- id
- gender_scope (male/female/unisex)
- title
- mesh_id
- parent_zone_id

PainReport
- id
- zone_id
- pain_character
- pain_intensity
- duration
- triggers[]
- additional_symptoms[]

ConditionRule
- id
- zone_id
- required_symptoms[]
- pain_character_weights
- intensity_range
- probable_condition_id
- score

SpecialistLink
- condition_id
- specialist_type
- urgency_level
```

---

## 4) Минимальный API (черновик)

### `POST /api/v1/session/start`
Создаёт сессию опроса.

### `GET /api/v1/anatomy-model?gender=male|female`
Возвращает URL 3D‑модели и конфигурацию зон.

### `POST /api/v1/pain/report`
Принимает:
- выбранную зону;
- характеристики боли;
- дополнительные симптомы.

Возвращает:
- список вероятных состояний с confidence score;
- список рекомендованных специалистов;
- red flags.

### `GET /api/v1/reference/specialists`
Возвращает справочник медицинских специальностей.

---

## 5) UX и безопасность

### UX
- Сначала 1–2 действия на экран, не перегружать вопросами.
- Показывать прогресс («Шаг 2 из 5»).
- Добавить кнопку «Не уверен(а)» для спорных вопросов.

### Безопасность и комплаенс
- Не хранить персональные медицинские данные без явного согласия.
- Шифровать данные в транзите и в БД.
- Добавить юридический дисклеймер и политику конфиденциальности.
- Исключить формулировки «у вас точно X» — только вероятностные подсказки.

---

## 6) План разработки по этапам

### Этап 1 (1–2 недели): прототип
- Страница выбора пола.
- 3D‑модель с вращением/зумом/кликом.
- Экран опроса боли.
- Мок‑ответы по специалистам.

### Этап 2 (2–4 недели): MVP
- Подключение БД и правил сопоставления.
- Админ‑панель для редактирования правил и справочников.
- Логи анонимной аналитики (самые частые зоны/симптомы).

### Этап 3: интеграции
- Telegram Mini App.
- Гео‑поиск клиник/врачей (если нужно).
- Персонализация и история (только с согласием пользователя).

---

## 7) Что можно сделать следующим шагом

1. Зафиксировать стек (Next.js + FastAPI или другой).
2. Выбрать/подготовить 3D‑модели мужского и женского тела.
3. Составить первичный медицинский справочник (зоны → гипотезы → специалисты) вместе с врачом‑консультантом.
4. Собрать кликабельный прототип интерфейса (Figma + быстрый frontend).

Если хотите, следующим шагом можно разложить это в конкретный backlog (эпики, user stories, приоритеты) и шаблон БД для запуска разработки.


## 8) Дополнительные артефакты по следующим шагам

Ниже уже зафиксированы конкретные материалы по вашим 4 пунктам:

1. **Зафиксированный стек** — `docs/stack-decision.md`.
2. **Подготовка 3D-моделей male/female** — `docs/3d-model-preparation.md`.
3. **Первичный медицинский справочник (черновой seed)** — `data/medical_reference_seed.csv`.
4. **План кликабельного прототипа (Figma + frontend)** — `docs/prototype-wireflow.md`.

> Важно: медицинский справочник в `data/medical_reference_seed.csv` — предварительный, должен быть обязательно валидирован профильным врачом-консультантом до использования в проде.
